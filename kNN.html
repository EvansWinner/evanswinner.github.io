<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Evans H. Winner" />
  <title>A K-Nearest Neighbors Classifier in Bash</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #c4a000; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #000000; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #000000; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #000000; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <style type="text/css">
  body {
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    color: #333;
    font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    font-size: 16px;
    line-height: 1.6;
    word-wrap: break-word;
    width: 728px;
    max-width: 99%;
    box-sizing: border-box;
    padding: 30px 30px 8rem 30px;
    margin-left: auto;
    margin-right: auto;
  }

  body a {
    background-color: transparent;
  }

  body a:active,
  body a:hover {
    outline: 0;
  }

  body strong {
    font-weight: bold;
  }

  body h1 {
    font-size: 2em;
    margin: 0.67em 0;
  }

  body hr {
    box-sizing: content-box;
    height: 0;
  }

  body pre {
    overflow: auto;
  }

  body code,
  body kbd,
  body pre {
    font-family: monospace, monospace;
    font-size: 1em;
  }

  body input {
    color: inherit;
    font: inherit;
    margin: 0;
  }

  body div {
      clear:both;
  }

  body html input[disabled] {
    cursor: default;
  }

  body input {
    line-height: normal;
  }

  body input[type="checkbox"] {
    box-sizing: border-box;
    padding: 0;
  }

  body table {
    border-collapse: collapse;
    border-spacing: 0;
  }

  body td,
  body th {
    padding: 0;
  }

  body * {
    box-sizing: border-box;
  }

  body input {
    font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  }

  body a {
    color: #4078c0;
    /* text-decoration: none; */
  }

  body a:hover,
  body a:active {
    text-decoration: underline;
  }

  body hr {
    height: 0;
    margin: 15px 0;
    overflow: hidden;
    background: transparent;
    border: 0;
    border-bottom: 1px solid #ddd;
  }

  body hr:before {
    display: table;
    content: "";
  }

  body hr:after {
    display: table;
    clear: both;
    content: "";
  }

  body h1,
  body h2,
  body h3,
  body h4,
  body h5,
  body h6 {
    margin-top: 15px;
    margin-bottom: 15px;
    line-height: 1.1;
  }

  body h1 {
    font-size: 30px;
  }

  body h2 {
    font-size: 21px;
  }

  body h3 {
    font-size: 16px;
  }

  body h4 {
    font-size: 14px;
  }

  body h5 {
    font-size: 12px;
  }

  body h6 {
    font-size: 11px;
  }

  body blockquote {
    margin: 0;
  }

  body ul,
  body ol {
    padding: 0;
    margin-top: 0;
    margin-bottom: 0;
  }

  body ol ol,
  body ul ol {
    list-style-type: lower-roman;
  }

  body ul ul ol,
  body ul ol ol,
  body ol ul ol,
  body ol ol ol {
    list-style-type: lower-alpha;
  }

  body dd {
    margin-left: 0;
  }

  body code {
    font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
    font-size: 12px;
  }

  body pre {
    margin-top: 0;
    margin-bottom: 0;
    font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  }

  body .select::-ms-expand {
    opacity: 0;
  }

  body .octicon {
    font: normal normal normal 16px/1 octicons-link;
    display: inline-block;
    text-decoration: none;
    text-rendering: auto;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
  }

  body .octicon-link:before {
    content: '\f05c';
  }

  body:before {
    display: table;
    content: "";
  }

  body:after {
    display: table;
    clear: both;
    content: "";
  }

  body>*:first-child {
    margin-top: 0 !important;
  }

  body>*:last-child {
    margin-bottom: 0 !important;
  }

  body a:not([href]) {
    color: inherit;
    text-decoration: none;
  }

  body .anchor {
    display: inline-block;
    padding-right: 2px;
    margin-left: -18px;
  }

  body .anchor:focus {
    outline: none;
  }

  body h1,
  body h2,
  body h3,
  body h4,
  body h5,
  body h6 {
    margin-top: 1em;
    margin-bottom: 16px;
    font-weight: bold;
    line-height: 1.4;
  }

  body h1 .octicon-link,
  body h2 .octicon-link,
  body h3 .octicon-link,
  body h4 .octicon-link,
  body h5 .octicon-link,
  body h6 .octicon-link {
    color: #000;
    vertical-align: middle;
    visibility: hidden;
  }

  body h1:hover .anchor,
  body h2:hover .anchor,
  body h3:hover .anchor,
  body h4:hover .anchor,
  body h5:hover .anchor,
  body h6:hover .anchor {
    text-decoration: none;
  }

  body h1:hover .anchor .octicon-link,
  body h2:hover .anchor .octicon-link,
  body h3:hover .anchor .octicon-link,
  body h4:hover .anchor .octicon-link,
  body h5:hover .anchor .octicon-link,
  body h6:hover .anchor .octicon-link {
    visibility: visible;
  }

  body h1 {
    padding-bottom: 0.3em;
    font-size: 1.75em;
    line-height: 1.2;
  }

  body h1 .anchor {
    line-height: 1;
  }

  body h2 {
    padding-bottom: 0.3em;
    font-size: 1.5em;
    line-height: 1.225;
  }

  body h2 .anchor {
    line-height: 1;
  }

  body h3 {
    font-size: 1.25em;
    line-height: 1.43;
  }

  body h3 .anchor {
    line-height: 1.2;
  }

  body h4 {
    font-size: 1em;
  }

  body h4 .anchor {
    line-height: 1.2;
  }

  body h5 {
    font-size: 1em;
  }

  body h5 .anchor {
    line-height: 1.1;
  }

  body h6 {
    font-size: 1em;
    color: #777;
  }

  body h6 .anchor {
    line-height: 1.1;
  }

  body p,
  body blockquote,
  body ul,
  body ol,
  body dl,
  body table,
  body pre {
    margin-top: 0;
    margin-bottom: 16px;
    clear:both;
  }

  body hr {
    height: 4px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
  }

  body ul,
  body ol {
    padding-left: 2em;
  }

  body ul ul,
  body ul ol,
  body ol ol,
  body ol ul {
    margin-top: 0;
    margin-bottom: 0;
  }

  body li>p {
    margin-top: 16px;
  }

  body dl {
    padding: 0;
  }

  body dl dt {
    padding: 0;
    margin-top: 16px;
    font-size: 1em;
    font-style: italic;
    font-weight: bold;
  }

  body dl dd {
    padding: 0 16px;
    margin-bottom: 16px;
  }

  body blockquote {
    padding: 0 15px;
    color: #777;
    border-left: 4px solid #ddd;
  }

  body blockquote>:first-child {
    margin-top: 0;
  }

  body blockquote>:last-child {
    margin-bottom: 0;
  }

  body table {
    display: block;
    width: 100%;
    overflow: auto;
    word-break: normal;
    word-break: keep-all;
  }

  body table th {
    font-weight: bold;
  }

  body table th,
  body table td {
    padding: 6px 13px;
    /* border: 1px solid #ddd; */
  }

  body table tr {
    /* background-color: #fff; */
    /* border-top: 1px solid #ccc; */
  }

  body table tr:nth-child(2n) {
    /* background-color: #f8f8f8; */
  }

  body img {
    max-width: 100%;
    box-sizing: content-box;
    background-color: #fff;
    padding:10px;
    clear:both;
  }

  body code {
    padding: 0;
    padding-top: 0;
    padding-bottom: 0;
    margin: 0;
    font-size: 85%;
    background-color: rgba(0,0,0,0.04);
    border-radius: 3px;
  }

  body code:before,
  body code:after {
    letter-spacing: -0.2em;
    content: "\00a0";
  }

  body pre>code {
    padding: 0;
    margin: 0;
    font-size: 100%;
    word-break: normal;
    white-space: pre;
    background: transparent;
    border: 0;
  }

  body .highlight {
    margin-bottom: 16px;
  }

  body .highlight pre,
  body pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border-radius: 3px;
  }

  body .highlight pre {
    margin-bottom: 0;
    word-break: normal;
  }

  body pre {
    word-wrap: normal;
  }

  body pre code {
    display: inline;
    max-width: initial;
    padding: 0;
    margin: 0;
    overflow: initial;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
  }

  body pre code:before,
  body pre code:after {
    content: normal;
  }

  body kbd {
    display: inline-block;
    padding: 3px 5px;
    font-size: 11px;
    line-height: 10px;
    color: #555;
    vertical-align: middle;
    background-color: #fcfcfc;
    border: solid 1px #ccc;
    border-bottom-color: #bbb;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #bbb;
  }

  body .pl-c {
    color: #969896;
  }

  body .pl-c1,
  body .pl-s .pl-v {
    color: #0086b3;
  }

  body .pl-e,
  body .pl-en {
    color: #795da3;
  }

  body .pl-s .pl-s1,
  body .pl-smi {
    color: #333;
  }

  body .pl-ent {
    color: #63a35c;
  }

  body .pl-k {
    color: #a71d5d;
  }

  body .pl-pds,
  body .pl-s,
  body .pl-s .pl-pse .pl-s1,
  body .pl-sr,
  body .pl-sr .pl-cce,
  body .pl-sr .pl-sra,
  body .pl-sr .pl-sre {
    color: #183691;
  }

  body .pl-v {
    color: #ed6a43;
  }

  body .pl-id {
    color: #b52a1d;
  }

  body .pl-ii {
    background-color: #b52a1d;
    color: #f8f8f8;
  }

  body .pl-sr .pl-cce {
    color: #63a35c;
    font-weight: bold;
  }

  body .pl-ml {
    color: #693a17;
  }

  body .pl-mh,
  body .pl-mh .pl-en,
  body .pl-ms {
    color: #1d3e81;
    font-weight: bold;
  }

  body .pl-mq {
    color: #008080;
  }

  body .pl-mi {
    color: #333;
    font-style: italic;
  }

  body .pl-mb {
    color: #333;
    font-weight: bold;
  }

  body .pl-md {
    background-color: #ffecec;
    color: #bd2c00;
  }

  body .pl-mi1 {
    background-color: #eaffea;
    color: #55a532;
  }

  body .pl-mdr {
    color: #795da3;
    font-weight: bold;
  }

  body .pl-mo {
    color: #1d3e81;
  }

  body kbd {
    display: inline-block;
    padding: 3px 5px;
    font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
    line-height: 10px;
    color: #555;
    vertical-align: middle;
    background-color: #fcfcfc;
    border: solid 1px #ccc;
    border-bottom-color: #bbb;
    border-radius: 3px;
    box-shadow: inset 0 -1px 0 #bbb;
  }

  body .task-list-item {
    list-style-type: none;
  }

  body .task-list-item+.task-list-item {
    margin-top: 3px;
  }

  body .task-list-item input {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
  }

  body :checked+.radio-label {
    z-index: 1;
    position: relative;
    border-color: #4078c0;
  }
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">A K-Nearest Neighbors Classifier in Bash</h1>
<p class="author">Evans H. Winner</p>
<p class="date">July 2019</p>
</header>
<h1 id="introduction">Introduction</h1>
<p>Here is an implementation of the classification version of the k-Nearest Neighbors algorithm using “pure” Bash. That is, Bash, plus standard Unix tools like sed, echo, and bc. In fact, bc is as close as we get to cheating, since we have to use it to do some basic mathematics. We also use curl to download our dataset.</p>
<p>Although the code attempts to be as general is possible, I’ve only tested it really on the famouse Iris dataset.</p>
<p>So, let’s launch into it. We will be using Euclidean distance between points, as it is the simplest, and this is just a proof of concept. In an N-dimensional space, we use an N-dimensional extension to the Pythagorean theorem, where distance, d is defined as the square root of a₁² + a₂² + ⋯ aₙ², and aₓ is the the difference between two values of a given variable (or axis).</p>
<p>So, for example, if we have the following two data points:</p>
<p>1 2 3 2 3 4</p>
<p>then the Euclidian distance between them will be the square root of (1-2)² + (2-3)² + (3-4)², which is the square root of 3, ≅ 1.73.</p>
<p>We need to choose a value for k for our algorithm. We can change it later and see what works best, but for the moment, let’s use 5.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="bu">declare</span> -i <span class="va">k=</span>5 # <span class="va">set</span> <span class="va">for</span> <span class="va">each</span> <span class="va">run</span> <span class="va">or</span> <span class="va">whatever</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Now, we will need a few basic mathematical functions which we’ll define using the Unix bc command:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="co">#export PATH=&quot;/usr/local/opt/coreutils/libexec/gnubin:$PATH&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="co">## `arith&#39; takes a value, an operator, and another value. We&#39;ll use to</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="co">## to define a couple of other math functions.</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="fu">arith()</span> <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;scale=4; </span><span class="va">$1</span><span class="st"> </span><span class="va">$2</span><span class="st"> </span><span class="va">$3</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">bc</span> -l <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^\./0./&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="co">## Based on this, we can define functions to calculate the square of a</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="co">## number, the square root, and then a sum of squares.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="fu">sqr()</span> <span class="kw">{</span> <span class="ex">arith</span> <span class="va">$1</span> <span class="st">&#39;*&#39;</span> <span class="va">$1</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="fu">sqrt()</span> <span class="kw">{</span> <span class="bu">echo</span> <span class="st">&quot;scale=4; sqrt(</span><span class="va">$1</span><span class="st">)&quot;</span> <span class="kw">|</span> <span class="fu">bc</span> -l <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/^\./0./&#39;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a><span class="fu">sum_of_squares()</span> <span class="kw">{</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">a=</span>0 # <span class="va">result</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>  <span class="kw">for</span> <span class="ex">s</span> in <span class="va">$*</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>  <span class="kw">do</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>    <span class="va">a=$(</span><span class="ex">arith</span> <span class="va">$a</span> <span class="st">&#39;+&#39;</span> <span class="va">$(</span><span class="ex">sqr</span> <span class="va">$s))</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>  <span class="kw">done</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>  <span class="bu">echo</span> <span class="va">$a</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>I don’t like using temporary files, but when you’re using Bash, it sometimes saves a lot of hassle. Let’s define what we’re going to need here:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="bu">declare</span> <span class="va">data=</span><span class="st">&quot;iris.dat&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="bu">declare</span> <span class="va">data_normalized=</span><span class="st">&quot;iris_normalized.dat&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="bu">declare</span> <span class="va">training=</span><span class="st">&quot;iris_training.dat&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a><span class="bu">declare</span> <span class="va">testing=</span><span class="st">&quot;iris_testing.dat&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a><span class="bu">declare</span> <span class="va">tmp_file=</span><span class="st">&quot;tmp.dat&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>The next step is to get the data:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="bu">declare</span> <span class="va">url=</span>https://archive.ics.uci.edu/ml/machine-learning-databases/iris/iris.data</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="co"># Get it only if we don&#39;t alreayd have it:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="bu">[</span> <span class="ot">-f</span> <span class="va">$data</span><span class="bu"> ]</span> <span class="kw">||</span> <span class="ex">curl</span> -s <span class="va">$url</span> <span class="op">&gt;</span> <span class="va">$data</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Let’s check to make sure the raw data is what we think it is:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a><span class="fu">head</span> -5 <span class="va">$data</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code>5.1,3.5,1.4,0.2,Iris-setosa
4.9,3.0,1.4,0.2,Iris-setosa
4.7,3.2,1.3,0.2,Iris-setosa
4.6,3.1,1.5,0.2,Iris-setosa
5.0,3.6,1.4,0.2,Iris-setosa</code></pre>
<p>Ok. Good, so then we have to clean the data a little to get it into a format we can use. The file comes with blank lines, which the later code won’t like, so let’s clean that up first:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a><span class="fu">remove_blanks()</span> <span class="kw">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a>  <span class="fu">sed</span> -i <span class="st">&quot;/^$/d&quot;</span> <span class="va">$1</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span class="ex">remove_blanks</span> <span class="va">$data</span> # remove blank lines</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>We also need to change from comma-delimted to space delimited:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="fu">sed</span> -i <span class="st">&quot;s/,/ /g&quot;</span> <span class="va">$data</span> <span class="co"># change to space delimited</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>The data are going to be in the form of observations, each of which is an m-length vector. We’ll need to know the value of m later:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="co"># Assuming a blank space for column separator, this returns the number</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="co"># of columns in a dataset</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="fu">cols()</span> <span class="kw">{</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">f=$1</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a>  <span class="fu">head</span> -n1 <span class="va">$f</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39; &#39;</span> <span class="st">&#39;\n&#39;</span> <span class="kw">|</span> <span class="fu">wc</span> -l</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true"></a><span class="bu">declare</span> -i <span class="va">vector_len=$(($(</span><span class="ex">cols</span> <span class="va">$data)</span> - 1<span class="va">))</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>We will also want to know some other information about our data for normalization later, so let’s write a basic routine to query the data and tell us what we need. You’ll notice that there is a comment at the start of the function that is a reminder of how to call the function. I tend to find that the thing I forget most easily in a language that doesn’t include function signitures is what I am expected to pass to the function. Most of the more complex functions here have similar comments at their starts. Anyway, the function to get column information:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="co"># col_info file column_number max/min/range</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="fu">col_info()</span> <span class="kw">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">seed=$(</span><span class="fu">cut</span> -d <span class="st">&#39; &#39;</span> -f <span class="va">$2</span> <span class="va">$data</span> <span class="kw">|</span> <span class="fu">head</span> -1<span class="va">)</span> # <span class="va">get</span> 1st <span class="va">value</span> <span class="va">as</span> <span class="va">seed</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">max=$seed</span>; <span class="bu">local</span> <span class="va">min=$seed</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true"></a>  <span class="kw">for</span> <span class="ex">n</span> in <span class="va">$(</span><span class="fu">cut</span> -d <span class="st">&#39; &#39;</span> -f <span class="va">$2</span> <span class="va">$1)</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true"></a>    <span class="kw">if</span> <span class="kw">((</span> <span class="va">$(</span><span class="ex">arith</span> <span class="va">$n</span> <span class="st">&#39;&gt;&#39;</span> <span class="va">$max)</span> <span class="kw">))</span>; <span class="kw">then</span> <span class="va">max=$n</span>; <span class="kw">fi</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true"></a>    <span class="kw">if</span> <span class="kw">((</span> <span class="va">$(</span><span class="ex">arith</span> <span class="va">$n</span> <span class="st">&#39;&lt;&#39;</span> <span class="va">$min)</span> <span class="kw">))</span>; <span class="kw">then</span> <span class="va">min=$n</span>; <span class="kw">fi</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true"></a>  <span class="kw">done</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true"></a>  <span class="kw">if [[</span> <span class="st">&quot;</span><span class="va">$3</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;range&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true"></a>    <span class="ex">arith</span> <span class="va">$max</span> <span class="st">&#39;-&#39;</span> <span class="va">$min</span><span class="kw">;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true"></a>  <span class="kw">elif [[</span> <span class="st">&quot;</span><span class="va">$3</span><span class="st">&quot;</span> <span class="ot">==</span> <span class="st">&quot;min&quot;</span><span class="kw"> ]]</span>; <span class="kw">then</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true"></a>    <span class="bu">echo</span> <span class="va">$min</span><span class="kw">;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true"></a>  <span class="kw">else</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true"></a>    <span class="bu">echo</span> <span class="va">$max</span><span class="kw">;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true"></a>  <span class="kw">fi</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Then let’s use it to populate some variables we can access later:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a><span class="bu">declare</span> -a <span class="va">ranges</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a><span class="bu">declare</span> -a <span class="va">mins</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true"></a><span class="kw">for</span> <span class="ex">i</span> in <span class="va">$(</span><span class="fu">seq</span> 1 <span class="va">$vector_len)</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true"></a>  <span class="va">ranges[$i]=$(</span><span class="ex">col_info</span> <span class="va">$data</span> <span class="va">$i</span> range<span class="va">)</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true"></a>  <span class="va">mins[$i]=$(</span><span class="ex">col_info</span> <span class="va">$data</span> <span class="va">$i</span> min<span class="va">)</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true"></a><span class="kw">done</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Now, the units of measurement for the various variables in our dataset may not have any particular relation to one-another, and so one variable may dominate the distance function, unless we normalize the data first — that is we scale all the variables to a value between 0 and 1. That way, they’re all playing on a level field, so to speak.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="co"># normalize_data file vector_length </span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a><span class="fu">normalize_data()</span> <span class="kw">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">file=$1</span>; <span class="bu">local</span> <span class="va">len=$2</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>  <span class="kw">while</span> <span class="bu">read</span> <span class="va">l</span>; <span class="kw">do</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a>    <span class="bu">local</span> -i <span class="va">field_count=</span>0</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>    <span class="kw">for</span> <span class="ex">v</span> in <span class="va">$l</span><span class="kw">;</span> <span class="kw">do</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a>      <span class="va">field_count+=</span>1</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a>      <span class="kw">if</span> <span class="kw">((</span> <span class="st">&quot;</span><span class="va">$field_count</span><span class="st">&quot;</span> &lt;= <span class="st">&quot;</span><span class="va">$len</span><span class="st">&quot;</span> <span class="kw">))</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a>      <span class="kw">then</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a>    <span class="bu">printf</span> <span class="st">&quot;%s &quot;</span> <span class="kw">\</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a>           <span class="va">$(</span><span class="ex">arith</span> <span class="va">$(</span><span class="ex">arith</span> <span class="va">$v</span> <span class="st">&#39;-&#39;</span> <span class="va">${mins[${field_count}]})</span> <span class="st">&#39;/&#39;</span> <span class="va">${ranges[${field_count}]})</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a>      <span class="kw">else</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a>    <span class="bu">echo</span> <span class="va">$v</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a>      <span class="kw">fi</span>                           </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a>    <span class="kw">done</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a>  <span class="kw">done</span> <span class="op">&lt;</span> <span class="va">$file</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Let’s run that now, and send it to a new file; then let’s once again print out the first few lines to verify that we’ve got it right:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a><span class="ex">normalize_data</span> <span class="va">$data</span> <span class="va">$vector_len</span> <span class="op">&gt;</span> <span class="va">$tmp_file</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a><span class="fu">mv</span> -f <span class="va">$tmp_file</span> <span class="va">$data_normalized</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a><span class="bu">echo</span> Normalized:</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a><span class="fu">head</span> -5 <span class="va">$data_normalized</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code>Normalized:
0.2222 0.6250 0.0677 0.0416 Iris-setosa
0.1666 0.4166 0.0677 0.0416 Iris-setosa
0.1111 0.5000 0.0508 0.0416 Iris-setosa
0.0833 0.4583 0.0847 0.0416 Iris-setosa
0.1944 0.6666 0.0677 0.0416 Iris-setosa</code></pre>
<p>Next, let’s “rotate” the data, to put the category of iris in each observation in the first column, instead of the last. That way we don’t have to worry about how many columns there are — we can just operate on “every column from the second to the end,” which seems easier.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a><span class="co"># rotate_cols file vector_length</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="fu">rotate_cols()</span> <span class="kw">{</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a>  <span class="bu">local</span> -i <span class="va">vector_length=$vector_len</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">file=$1</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>  <span class="ex">paste</span> -d <span class="st">&quot; &quot;</span> <span class="op">&lt;(</span><span class="fu">cut</span> -d <span class="st">&quot; &quot;</span> -f <span class="va">$((</span>vector_length + 1<span class="va">))</span> <span class="va">$file</span><span class="op">)</span> <span class="kw">\</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a>    <span class="op">&lt;(</span><span class="fu">cut</span> -d <span class="st">&quot; &quot;</span> -f -<span class="va">$vector_len</span> <span class="va">$file</span><span class="op">)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Once again, let’s apply the function to our data, and then print out the first few lines to check it:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a><span class="ex">rotate_cols</span> <span class="va">$data_normalized</span> <span class="va">$vector_len</span> <span class="op">&gt;</span> <span class="va">$tmp_file</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a><span class="fu">mv</span> -f <span class="va">$tmp_file</span> <span class="va">$data_normalized</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true"></a><span class="bu">echo</span> Rotated:</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true"></a><span class="fu">head</span> -5 <span class="va">$data_normalized</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code>Rotated:
Iris-setosa 0.2222 0.6250 0.0677 0.0416
Iris-setosa 0.1666 0.4166 0.0677 0.0416
Iris-setosa 0.1111 0.5000 0.0508 0.0416
Iris-setosa 0.0833 0.4583 0.0847 0.0416
Iris-setosa 0.1944 0.6666 0.0677 0.0416</code></pre>
<p>Now, with the kNN procedure, you don’t exactly need a training set to run first. What you do is simply take a set of data that are already classified, and then check a new observation by running it against all the existing classified data. But we don’t have any new observations. So what we’ll do to test the implementation is we will pick out some “test” data from the whole dataset, and then we will run them against the remaining data from the original dataset and see if, or how many of them get classified in the same way that they came to us.</p>
<p>So first, we need to know how many data points are in our original dataset:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a><span class="co"># How many observations?</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="fu">obs()</span> <span class="kw">{</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">file=$1</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a>  <span class="fu">wc</span> -l <span class="va">$file</span> <span class="kw">|</span> <span class="fu">cut</span> -d <span class="st">&quot; &quot;</span> -f 1<span class="kw">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true"></a><span class="bu">declare</span> -i <span class="va">number_of_observations=$(</span><span class="ex">obs</span> <span class="va">$data_normalized)</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true"></a><span class="bu">echo</span> k=<span class="va">${k}</span>, n=<span class="va">${number_of_observations}</span>.</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code>k=5, n=150.</code></pre>
<p>Next, let’s write a function that will split our data into a “testing” set and a “be tested against” set. We could write a complicated randomization routine, but I think it will be just as good to simply extract every n-th observation, with 1/n representing the proportion of “test” data to extract from the dataset.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="co"># split_data every_nth_goes_to_testing_file input_file testing_output_file \</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="co">#            training_output_file</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a><span class="fu">split_data()</span> <span class="kw">{</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a>  <span class="bu">local</span> -i <span class="va">nth=$1</span>; <span class="bu">local</span> <span class="va">infile=$2</span>; <span class="bu">local</span> <span class="va">tst=$3</span>; <span class="bu">local</span> <span class="va">trn=$4</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a>  </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true"></a>  <span class="bu">local</span> -i <span class="va">l=</span>0</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true"></a>  <span class="kw">while</span> <span class="bu">read</span> <span class="va">line</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true"></a>  <span class="kw">do</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true"></a>    <span class="bu">let</span> l+=1</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true"></a>    <span class="kw">if</span> <span class="kw">((</span>l % nth<span class="kw">))</span>; <span class="kw">then</span> <span class="kw">{</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true"></a>      <span class="bu">echo</span> <span class="va">$line</span> <span class="op">&gt;&gt;</span> <span class="va">$trn</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true"></a>    <span class="kw">}</span> <span class="kw">else</span> <span class="kw">{</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true"></a>      <span class="bu">echo</span> <span class="va">$line</span> <span class="op">&gt;&gt;</span> <span class="va">$tst</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true"></a>    <span class="kw">}</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true"></a>    <span class="kw">fi</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true"></a>  <span class="kw">done</span> <span class="op">&lt;</span> <span class="va">$infile</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>So, let’s do it. We’ll use the magic number 5 for our n:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a><span class="bu">[</span> <span class="ot">-f</span> <span class="va">$training</span><span class="bu"> ]</span> <span class="kw">||</span> <span class="ex">split_data</span> 5 <span class="va">$data_normalized</span> <span class="va">$testing</span> <span class="va">$training</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>Ok, so now, we need to actually write the core of the procedure. First, of course, we need to be able to calculate the pythagorean distance function:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a><span class="fu">pyth()</span> <span class="kw">{</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a>  <span class="ex">sqrt</span> <span class="va">$(</span><span class="ex">sum_of_squares</span> <span class="va">$*)</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>By the way, we’ll need a utility to get just the n-th line of a dataset:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a><span class="co"># get_line file n</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a><span class="fu">get_line()</span> <span class="kw">{</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">file=$1</span>; <span class="bu">local</span> -i <span class="va">n=$2</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true"></a>  <span class="fu">head</span> -<span class="va">$n</span> <span class="va">$file</span> <span class="kw">|</span> <span class="fu">tail</span> -1</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code></code></pre>
<p>I guess this is where it gets real.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a><span class="co">#### Code Cell Start ##########</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a><span class="fu">deltas()</span> <span class="kw">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">args_len=$#</span>; <span class="bu">local</span> -a <span class="va">data_vector</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a>  <span class="kw">for</span> <span class="kw">((</span>i=0;i&lt;<span class="va">$vector_len</span>;i++<span class="kw">))</span>; <span class="kw">do</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a>    <span class="va">data_vector[$i]=$1</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a>    <span class="bu">shift</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a>  <span class="kw">done</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a>  <span class="kw">for</span> <span class="kw">((</span>i=<span class="va">$vector_len</span>;i&lt;<span class="va">$args_len</span>;i++<span class="kw">))</span>; <span class="kw">do</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a>    <span class="va">j=$(($i</span>-<span class="va">$vector_len))</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a>    <span class="va">query_vector[$j]=$1</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true"></a>    <span class="bu">shift</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true"></a>  <span class="kw">done</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true"></a>  <span class="kw">for</span> <span class="kw">((</span>i=0;i&lt;<span class="va">$vector_len</span>;i++<span class="kw">))</span>; <span class="kw">do</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true"></a>    <span class="ex">arith</span> <span class="va">${data_vector[$i]}</span> <span class="st">&#39;-&#39;</span> <span class="va">${query_vector[$i]}</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true"></a>  <span class="kw">done</span>  <span class="kw">|</span> <span class="fu">fmt</span> -60</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true"></a><span class="co"># parse_record file line records-in-cut-format</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true"></a><span class="fu">parse_record()</span> <span class="kw">{</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">file=$1</span>; <span class="bu">local</span> -i <span class="va">n=$2</span>; <span class="bu">local</span> <span class="va">recs=$3</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true"></a>    <span class="fu">cut</span> -d <span class="st">&#39; &#39;</span> -f <span class="va">$recs</span> <span class="op">&lt;(</span><span class="ex">get_line</span> <span class="va">$file</span> <span class="va">$n</span><span class="op">)</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true"></a><span class="co"># distances_from file vector_len query_value1 query_value2 ...</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true"></a><span class="fu">distances_from()</span> <span class="kw">{</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">file=$1</span>; <span class="bu">local</span> -i <span class="va">rec=$2</span>;</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true"></a>  <span class="bu">shift</span> 2</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true"></a>  <span class="bu">local</span> -i <span class="va">i=</span>0</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true"></a>  <span class="kw">while</span> <span class="bu">read</span>;</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true"></a>  <span class="kw">do</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true"></a>    <span class="va">i+=</span>1</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true"></a>    <span class="bu">echo</span> <span class="va">$(</span><span class="ex">pyth</span> <span class="kw">\</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true"></a>         <span class="va">$(</span><span class="ex">deltas</span> <span class="kw">\</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true"></a>         <span class="va">$(</span><span class="ex">parse_record</span> <span class="kw">\</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true"></a>             <span class="va">$file</span> <span class="va">$i</span> <span class="ex">2-</span><span class="va">$((</span> <span class="va">$rec</span> + 1 <span class="va">)))</span> <span class="va">$@</span> <span class="va">))</span> <span class="st">&quot; &quot;</span> <span class="kw">\</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true"></a>     <span class="va">$(</span><span class="ex">parse_record</span> <span class="va">$file</span> <span class="va">$i</span> 1<span class="va">)</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true"></a>    </span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true"></a>  <span class="kw">done</span> <span class="op">&lt;</span> <span class="va">$file</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true"></a><span class="co"># vote training_file vector_len testing_file testing_record</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true"></a><span class="fu">vote()</span> <span class="kw">{</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">trn=$1</span>; <span class="bu">local</span> -i <span class="va">len=$2</span>; <span class="bu">local</span> <span class="va">tst=$3</span>; <span class="bu">local</span> -i <span class="va">rec=$4</span>;</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true"></a>  <span class="bu">local</span> -A <span class="va">cats</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true"></a>  <span class="kw">while</span> <span class="bu">read</span> <span class="va">line</span>; <span class="kw">do</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true"></a>    <span class="bu">echo</span> <span class="op">&gt;</span> <span class="va">$tmp_file</span></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true"></a>    <span class="va">cats[$line]=$((</span> <span class="va">${cats[$line]}</span> + 1 <span class="va">))</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true"></a>  <span class="kw">done</span> <span class="op">&lt;</span> <span class="op">&lt;(</span><span class="fu">cut</span> <span class="kw">\</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true"></a>         <span class="ex">-d</span> <span class="st">&#39; &#39;</span> -f 2 <span class="kw">\</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true"></a>         <span class="op">&lt;(</span><span class="ex">distances_from</span> <span class="va">$trn</span> <span class="va">$len</span> <span class="kw">\</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true"></a>                  <span class="va">$(</span><span class="ex">parse_record</span> <span class="va">$tst</span> <span class="va">$rec</span> 2-<span class="va">)</span> <span class="kw">|</span> <span class="kw">\</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true"></a>         <span class="fu">sort</span> <span class="kw">|</span> <span class="fu">head</span> -<span class="va">$k</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;s/ \+/ /g&#39;</span><span class="op">))</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true"></a>  <span class="kw">for</span> <span class="ex">c</span> in <span class="va">${!cats[@]}</span><span class="kw">;</span> <span class="kw">do</span> <span class="bu">echo</span> <span class="va">${cats[$c]}</span> <span class="va">$c</span> <span class="va">$(</span><span class="ex">parse_record</span> <span class="va">$tst</span> <span class="va">$rec</span> 1<span class="va">)</span> <span class="op">&gt;&gt;</span> <span class="va">$tmp_file</span><span class="kw">;</span> <span class="kw">done</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true"></a>  <span class="ex">remove_blanks</span> <span class="va">$tmp_file</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true"></a>  <span class="fu">sort</span> -g -r <span class="va">$tmp_file</span> <span class="kw">|</span> <span class="fu">head</span> -1 <span class="op">&gt;</span> <span class="va">$tmp_file</span>.2</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true"></a>  <span class="fu">cat</span> <span class="va">$tmp_file</span>.2</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true"></a>  <span class="bu">unset</span> <span class="va">cats</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true"></a></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true"></a><span class="co"># training_file vector_len testing_file</span></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true"></a><span class="fu">votes()</span> <span class="kw">{</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true"></a>  <span class="bu">local</span> <span class="va">trn=$1</span>; <span class="bu">local</span> -i <span class="va">len=$2</span>; <span class="bu">local</span> <span class="va">tst=$3</span>;</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true"></a>  <span class="bu">local</span> -i <span class="va">n=</span>0</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true"></a>  <span class="kw">while</span> <span class="bu">read</span>; <span class="kw">do</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true"></a>    <span class="bu">let</span> n+=1</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true"></a>    <span class="bu">echo</span> Instance <span class="va">$n</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true"></a>    <span class="ex">vote</span> <span class="va">$trn</span> <span class="va">$len</span> <span class="va">$tst</span> <span class="va">$n</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true"></a>  <span class="kw">done</span> <span class="op">&lt;</span> <span class="va">$tst</span></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true"></a><span class="kw">}</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true"></a></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true"></a><span class="ex">votes</span> <span class="va">$training</span> <span class="va">$vector_len</span> <span class="va">$testing</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true"></a><span class="co">###############################</span></span></code></pre></div>
<pre><code>Instance 1
5 Iris-setosa Iris-setosa
Instance 2
5 Iris-setosa Iris-setosa
Instance 3
5 Iris-setosa Iris-setosa
Instance 4
5 Iris-setosa Iris-setosa
Instance 5
5 Iris-setosa Iris-setosa
Instance 6
5 Iris-setosa Iris-setosa
Instance 7
5 Iris-setosa Iris-setosa
Instance 8
5 Iris-setosa Iris-setosa
Instance 9
5 Iris-setosa Iris-setosa
Instance 10
5 Iris-setosa Iris-setosa
Instance 11
4 Iris-versicolor Iris-versicolor
Instance 12
5 Iris-versicolor Iris-versicolor
Instance 13
5 Iris-versicolor Iris-versicolor
Instance 14
5 Iris-versicolor Iris-versicolor
Instance 15
5 Iris-versicolor Iris-versicolor
Instance 16
5 Iris-versicolor Iris-versicolor
Instance 17
5 Iris-versicolor Iris-versicolor
Instance 18
5 Iris-versicolor Iris-versicolor
Instance 19
5 Iris-versicolor Iris-versicolor
Instance 20
5 Iris-versicolor Iris-versicolor
Instance 21
5 Iris-virginica Iris-virginica
Instance 22
5 Iris-virginica Iris-virginica
Instance 23
5 Iris-virginica Iris-virginica
Instance 24
4 Iris-versicolor Iris-virginica
Instance 25
5 Iris-virginica Iris-virginica
Instance 26
3 Iris-virginica Iris-virginica
Instance 27
4 Iris-versicolor Iris-virginica
Instance 28
5 Iris-virginica Iris-virginica
Instance 29
5 Iris-virginica Iris-virginica
Instance 30
4 Iris-virginica Iris-virginica</code></pre>
<p>There you go….</p>
<p>Ok, I kind of lost interest in documenting this and making it better. It’s a proof-of-concept, after all. And it seems to work – and it could be implemented in a single line of APL, probably.</p>
</body>
</html>
